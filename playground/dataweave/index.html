<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataWeave to Ballerina Converter</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>DataWeave to Ballerina Converter</h1>
<p class="notice">Paste your DataWeave script below and click "Convert".</p>

<form id="convertForm">
    <label for="dataweaveInput">DataWeave Script:</label>
    <textarea id="dataweaveInput" rows="10" cols="50"></textarea>
    <button type="submit">Convert</button>
</form>

<h2>Generated Ballerina Code:</h2>
<pre id="output"></pre>
<button id="downloadButton" style="display: none;">Download .bal File</button>

<script>
    //document.getElementById('convertForm').addEventListener('submit', async function(event) {
  //    event.preventDefault();
  //
  //    const dataweaveScript = document.getElementById('dataweaveInput').value;
  //
  //    if (!dataweaveScript.trim()) {
  //        alert("Please enter a DataWeave script.");
  //        return;
  //    }
  //
  //    try {
  //        const response = await fetch('http://localhost:8080/convert', {
  //            method: 'POST',
  //            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
  //            body: 'postData=' + encodeURIComponent(dataweaveScript)
  //        });
  //
  //        if (response.ok) {
  //            try {
  //                const convertedText = await response.text();
  //                document.getElementById('output').textContent = convertedText;
  //                document.getElementById('downloadButton').style.display = 'block';
  //            } catch (textError) {
  //                console.error("Error processing text:", textError);
  //                alert("Error processing the server response.");
  //            }
  //        } else {
  //            const errorText = await response.text();
  //            alert("Conversion failed. Server returned: " + response.status + " " + response.statusText + "\n" + errorText);
  //        }
  //    } catch (error) {
  //        console.error("Fetch error:", error);
  //        alert("An unexpected error occurred: " + error.message);
  //    }
  //});
  //
  //document.getElementById('downloadButton').addEventListener('click', function() {
  //    const convertedText = document.getElementById('output').textContent;
  //    const blob = new Blob([convertedText], { type: 'text/plain' });
  //    const url = URL.createObjectURL(blob);
  //    const a = document.createElement('a');
  //    a.href = url;
  //    a.download = 'converted.bal';
  //    document.body.appendChild(a);
  //    a.click();
  //    document.body.removeChild(a);
  //    URL.revokeObjectURL(url);
  //});

  document.getElementById('convertForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const dataweaveScript = document.getElementById('dataweaveInput').value;

      try {
          const response = await fetch('http://localhost:8080/convert', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: 'postData=' + encodeURIComponent(dataweaveScript)
          });

          if (response.ok) {
              const convertedText = await response.text();
              document.getElementById('output').textContent = convertedText;
          } else {
              console.error("Server error:", response.status, response.statusText);
              alert("Server error: " + response.status + " " + response.statusText);
          }
      } catch (error) {
          console.error("Fetch error:", error);
          alert("An unexpected error occurred: " + error.message);
      }
  });
</script>
</body>
</html>
